```{r include = FALSE}
options(scipen=999)
```

## Homeworked Example


### Working the Problem with R and R Packages

#### Create a df with 3 continuously scaled variables of interest {-}

MADdf is the entire dataset. Let's first open it. 

```{r}
MADdf <- readRDS("MADdf.rds")
```

Participants in this study could contribute up to 24 pieces of data. I will just select wave one

```{r tidy=TRUE, tidy.opts=list(width.cutoff=70)}
w1MAD <- subset(MADdf, Index == 1) 
```

#### Create a df with 3 continuously scaled variables of interest {-}

The assignment requires that we downsize to three variables. We could pick any three. 

```{r tidy=TRUE, tidy.opts=list(width.cutoff=70)}
library(tidyverse)
tiny3 <- w1MAD %>%
    dplyr::select (mCases, StigmaFelt, myFMprop)
```

#### Produce descriptive statistics {-}

```{r}
psych::describe(tiny3, type = 1)
```

#### Produce SPLOM/pairs.panels {-}

```{r}
psych::pairs.panels(tiny3)
```

#### Produce an apaTables matrix {-}

```{r}
apaTables::apa.cor.table(tiny3, filename = "MaskTable.doc", show.conf.interval=FALSE, show.sig.stars = TRUE, table.number = 1)
```
#### Produce an APA Style write-up of the preliminary analyses {-}

>Our sample included 201 adults in the U.S. in the early weeks of the COVID-19 pandemic. Visual inspection of the three variables (facemask wearing proportion, metric COVID case counts, and proportion of Republican voting) combined with formal evaluation of skewness and kurtosis suggested that that the distribution of the COVID cases likely violated the assumption of univariate normality. That is, metric COVID cases were positively skewed (type 1 skew value was 5.40) and leptokurtic (type 1 kurtosis value was 36.75). For the facemask wearing proportion and perceived stigma variables, skew values fell below the absolute value of 3 and kurtosis values  fell below the absolute value of 10 [@kline_data_2016]. Means, standard deviations, and a correlation matrix are presented in Table 1. Only the correlation between perceived stigma and proportion of facemask wearing was statistically significant $(r = -.27, p < .01)$

### Hand Calculations

I am going to continue with the *tiny3* dataset above.

To avoid problems in the code we are used that is caused by missingness, we will eliminate any rows with missing data.
```{r}
tiny3 <- na.omit(tiny3)
```


#### Create a variable that represents the mean {-}

I will start with the StigmaFelt variable. Inspect the dataframe to see that this new variable exists.

```{r tidy=TRUE, tidy.opts=list(width.cutoff=70)}
tiny3$M_SF <- mean(tiny3$StigmaFelt, na.rm=TRUE)
head(tiny3)
```

#### Create a variable that represents the mean deviation {-}

$$(X_{i} - \bar{X})$$
 
```{r tidy=TRUE, tidy.opts=list(width.cutoff=70)}
tiny3$Mdev_SF <- (tiny3$StigmaFelt-tiny3$M_SF)
head(tiny3)
```

Inspect the dataframe to see that this new variable exists. Note that this functions to "center" the mean around zero.


#### What is the value of the sum of mean deviations? {-}

$$SS = \sum(X_{i} - \bar{X})$$

```{r tidy=TRUE, tidy.opts=list(width.cutoff=70)}
round(sum(tiny3$Mdev_SF, na.rm = TRUE), 3)
```
Yes, zero!

#### Create a variable that represents the absolute mean deviation {-}

$$|X_{i} - \bar{X}|$$

```{r tidy=TRUE, tidy.opts=list(width.cutoff=70)}
tiny3$abslt_mdSF <- abs(tiny3$Mdev_SF)
head(tiny3)
```

Inspect the dataframe to see that this new variable no longer has negative values.

**What is the value of the sum of the absolute mean deviation?**

$$\sum_{i=1}^{n}|X_{i} - \bar{X}|$$

```{r tidy=TRUE, tidy.opts=list(width.cutoff=70)}
round(sum(tiny3$abslt_mdSF, na.rm = TRUE), 3)
```

**What is the value of the mean of the absolute mean deviation?**

```{r tidy=TRUE, tidy.opts=list(width.cutoff=70)}
round(mean(tiny3$abslt_mdSF, na.rm = TRUE), 3)
```

**What does this value tell you?**

Average distance of each value from the mean.

#### Create a variable that represents the mean deviation squared {-}

$$(X_{i} - \bar{X})^{^{2}}$$

```{r tidy=TRUE, tidy.opts=list(width.cutoff=70)}
tiny3$mdev2_SF <- (tiny3$Mdev_SF * tiny3$Mdev_SF)
head(tiny3)
```

**What is the value of the sum of squared deviations around the mean (also known as sums of squares; sometimes abbreviated as $SS$)?**

$$SS = \sum_{i=1}^{n}(X_{i} - \bar{X})^{^{2}}$$

```{r tidy=TRUE, tidy.opts=list(width.cutoff=70)}
sum(tiny3$mdev2_SF, na.rm = TRUE)
```

**What is the value of the variance ($s^2$)?**

$$s^{2}=\frac{SS}{N-1}=\frac{\sum_{i=1}^{n}(X_{i} - \bar{X})^{^{2}}}{N-1}$$

There are at least two ways to do this with basic code (and then we can check our work).

Here's how to do it with "more code."
```{r tidy=TRUE, tidy.opts=list(width.cutoff=70)}
var_SF <- sum(tiny3$mdev2_SF/((nrow(tiny3) - 1)))
var_SF
```

Here's how to do it with the numbers that I calculated:
```{r tidy=TRUE, tidy.opts=list(width.cutoff=70)}
93.43192/(164-1)
```

Checking my work with the *var* function from base R. If it's wrong, I need to rework some of the previous steps.
```{r tidy=TRUE, tidy.opts=list(width.cutoff=70)}
var(tiny3$StigmaFelt, na.rm = TRUE) #checking my work
```

**What is the value of the standard deviation ($s$)?**

$$s=\sqrt{\frac{SS}{N-1}}=\sqrt{\frac{\sum_{i=1}^{n}(X_{i} - \bar{X})^{^{2}}}{N-1}}$$

There are two ways to calculate it with basic code; and then we can check it with more code from base R.

```{r tidy=TRUE, tidy.opts=list(width.cutoff=70)}
sd_SF <- sqrt(var_SF)#calculating with the object I created
sd_SF
sqrt (0.573202)#calculated with the actual numbers
sd(tiny3$StigmaFelt)#checking my work with the code from baseR
```

#### Using the same general approach, calculate the mean deviation and standard deviation for a second, continuously scaled variable {-}

My second variable is MyContribution
```{r tidy=TRUE, tidy.opts=list(width.cutoff=70)}
#first the mean
tiny3$M_FMP <- mean(tiny3$myFMprop, na.rm=TRUE)
#second the mean deviation
tiny3$Mdev_FMP <- (tiny3$myFMprop-tiny3$M_FMP)
#third the mean deviation squared
tiny3$mdev2_FMP <- (tiny3$Mdev_FMP * tiny3$Mdev_FMP)
head(tiny3)

#fourth the variance
var_FMP <- sum(tiny3$mdev2_FMP/((nrow(tiny3) - 1)))
var_FMP
#finally the standard deviation
sd_FMP <- sqrt(var_FMP)
sd_FMP#checking my work

sd(tiny3$myFMprop)#checking my work
```

#### Create a variable that represents the *cross-product* (of the mean deviations). What is the sum of these cross-products? {-}

$$
\mbox{Cov}(X,Y) = \frac{1}{N-1} \sum_{i=1}^N \left( X_i - \bar{X} \right) \left( Y_i - \bar{Y} \right)
$$

```{r tidy=TRUE, tidy.opts=list(width.cutoff=70)}
tiny3$crossproduct <- (tiny3$Mdev_SF * tiny3$Mdev_FMP)
head(tiny3)
```

The sum of the crossproduct is:

```{r}
xp_sum <- sum(tiny3$crossproduct)
xp_sum
```

#### Calculate the value of their covariance {-} 

```{r}
cov <- (1/(164-1)) * -1041.466
cov
```

#### Calculate value of correlation coefficient {-}

$$
r_{XY}  = \frac{\mbox{Cov}(X,Y)}{ \hat{\sigma}_X \ \hat{\sigma}_Y}
$$

```{r}
-6.389362/(0.757101*31.72994)

```
And now I can check my work with a function from base R.
```{r tidy=TRUE, tidy.opts=list(width.cutoff=70)}
cor.test(tiny3$StigmaFelt, tiny3$myFMprop)
```
The correlation between ratings of facemask stigma and the proportion of time participants wore facemasks is $-0.266, p < .001$.











